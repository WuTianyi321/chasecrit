# SOC-v2 方案：基于预测熵波动的自组织临界控制

## 1. 目的

本文提出一个面向追逃任务的 SOC-v2 控制方案，用于回答两个核心问题：

1. 系统是否能在无全局控制参数扫描的情况下自发进入近临界状态；
2. 该状态是否在追逃任务中带来性能收益。

## 2. 对当前版本的修正动机

现有实现中，个体对齐权重会向固定 `w_align` 回归。该机制更接近“带设定点的自适应控制”，而非严格意义上的自组织临界：

1. 固定回归点会持续注入外部稳态约束；
2. 系统更容易围绕人为目标振荡，而非在慢驱动-快释放机制下自发组织到临界边缘；
3. 临界性统计可能被设定点效应污染。

SOC-v2 的原则是：去除对固定 `w_align` 的回归，把行为调节完全交给局部状态和相互作用。

## 3. SOC-v2 核心状态与局部可观测量

对每个逃跑者 \(i\)，维护以下局部状态：

- \(s_i(t)\)：应力（stress）
- \(\lambda_i(t)\in[\lambda_{\min},\lambda_{\max}]\)：对齐占比（动态）
- \(H_i(t)\)：局部预测熵（由单体历史动作序列预测下一步方向得到）

局部输入量：

- `threat_i(t)`：追捕压力（由最近追捕者距离局部计算）
- `u_i(t)`：可预测性波动驱动项（由预测熵波动构造）

建议定义：
\[
u_i(t)=\left|H_i(t)-\text{EMA}_\tau(H_i)(t)\right|
\]
或窗口方差近似：
\[
u_i(t)=\operatorname{Var}_{t-W+1:t}(H_i)
\]

## 4. SOC-v2 更新方程

### 4.1 慢驱动（stress accumulation）

\[
s_i(t+1)=(1-\mu)s_i(t)+\alpha\cdot threat_i(t)+\beta\cdot u_i(t)
\]

其中 \(\mu\in(0,1)\) 为耗散项，\(\alpha,\beta>0\)。

### 4.2 阈值释放（toppling）

若 \(s_i(t+1)>\theta\)，触发 toppling：

1. 本地释放：
\[
s_i \leftarrow \max(0, s_i-\Delta)
\]
2. 邻域传播（图邻居 \(\mathcal N(i)\)）：
\[
s_j \leftarrow s_j + \kappa\frac{\Delta}{\max(1,|\mathcal N(i)|)},\quad j\in\mathcal N(i)
\]
3. 行为重置：\(\lambda_i\) 发生瞬时下调（增大非对齐驱动比重）：
\[
\lambda_i \leftarrow \max(\lambda_{\min},\lambda_i-\delta_\lambda)
\]

### 4.3 非 toppling 时的 \(\lambda\) 更新（无设定点回归）

SOC-v2 不向 `w_align` 回归。推荐直接由应力映射：
\[
\lambda_i(t)=\sigma\!\big(-g(s_i(t)-\theta)\big)\cdot(\lambda_{\max}-\lambda_{\min})+\lambda_{\min}
\]
其中 \(\sigma(\cdot)\) 为 sigmoid，\(g>0\) 控制斜率。

该式含义：

- 应力低：\(\lambda_i\) 较高，群体更一致；
- 应力高：\(\lambda_i\) 下降，个体更偏局部规避/探索；
- 不依赖固定外部设定点。

### 4.4 运动合成

\[
d_i=\lambda_i d_i^{align} + (1-\lambda_i)d_i^{nonalign}
\]
其中
\[
d_i^{nonalign}= \operatorname{unit}\!\left(
w_{avoid}d_i^{avoid}+w_{goal}d_i^{goal}+w_{explore}d_i^{explore}+d_i^{sep}
\right)
\]

## 5. 与参考论文思路的一致性

参考论文（`1-s2.0-S0378437125007290-main.pdf`）的关键贡献是使用 `Var(H_pred)` 盲识别临界区。SOC-v2 的对应关系：

1. 不再依赖“预先扫描全局控制参数”定位临界点；
2. 使用单体轨迹构造的预测熵波动 \(u_i(t)\) 作为局部驱动；
3. 把“预测性波动”嵌入在线控制闭环，而不仅做离线诊断。

因此，`Var(H_pred)` 在本方案中同时承担：

- 诊断指标（离线判定近临界）；
- 局部驱动项（在线 SOC 调节）。

## 6. “SOC 成立”判据（先于任务优势判定）

在无追逃任务目标干扰（或弱干扰）条件下，至少满足以下多证据标准：

1. **初值鲁棒性**：不同 \(s(0),\lambda(0)\) 收敛到相似统计态；
2. **级联统计**：事件规模 \(S\) 与持续时间 \(T\) 的分布接近截断幂律，且优于指数拟合；
3. **分支比**：\(\sigma\approx1\)（临界附近）；
4. **谱特征**：活动序列功率谱满足 \(1/f^\beta\)（\(\beta\) 接近 1）；
5. **有限尺寸趋势**：系统规模增大时，关键峰值更尖锐或更稳定。

若仅有单一指标（例如只看 \(\chi\)）不视为“已证实 SOC”。

## 7. 任务优势验证协议

在确认机制成立后，再做任务优势验证：

1. 对照组：
   - 固定参数基线（最佳 `w_align` 扫描结果）；
   - 非 SOC 自适应策略（若存在）；
   - SOC-v2。
2. 分层评估：按 `speed_ratio` 分层（至少 `1.0, 1.2, 1.4`）。
3. 指标：
   - 主指标：`safe_frac`
   - 风险指标：尾部失败率、分位数、CVaR
   - 机制指标：`soc_branch_ratio`, avalanche 统计, `Var(H_pred)`
4. 结论要求：
   - 同时报告“机制证据”和“任务收益证据”；
   - 若收益只在部分压力层成立，应明确写为条件结论。

## 8. 最小实现路线（工程）

### 阶段 A：机制实现与正确性

1. 去除 SOC 分支中对固定 `w_align` 的回归；
2. 引入 \(\lambda_i=f(s_i)\) 映射；
3. 增加 `u_i(t)` 的在线近似（先用轻量 n-gram/EMA 版本）。

### 阶段 B：机制实验（小规模）

1. 无追捕或弱追捕场景；
2. 扫描 \(\theta,\kappa,\Delta\)；
3. 输出 avalanche 分布、分支比、谱、初值鲁棒性图。

### 阶段 C：任务实验（分层）

1. 固定场景做 `speed_ratio` 分层对照；
2. 对每层报告 SOC 成立性与 `safe_frac` 增益是否同时出现；
3. 对不成立层做失效机制分析（拥挤、路径竞争、受迫有序）。

## 9. 预期风险与控制

1. 过活跃（超临界）导致任务性能下降：提高阈值、降低耦合；
2. 过抑制（亚临界）导致无级联：降低阈值或提高驱动；
3. `H_pred` 估计噪声偏大：先用短窗口平滑 + 多 seed 聚合；
4. 任务结论与机制结论冲突：坚持“先机制成立，再谈优势”。
