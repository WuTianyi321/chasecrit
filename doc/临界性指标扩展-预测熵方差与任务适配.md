# 临界性指标扩展：预测熵方差方法及其在追逃任务中的适配

## 1. 背景与问题

在当前追逃任务中，原始轨迹层面的 `chi` 与生存率关系较弱，且在强外场（高追捕压力）下容易出现“高涨落但低绩效”的解耦现象。传统 `chi`、`P`、`xi` 等指标在复杂任务中的解释力受限，核心原因是：

1. 任务目标与对抗反馈引入了强非平稳性；
2. 同一 `chi` 可对应不同“行为机理”（探索、受迫规避、拥挤竞争）；
3. 全局序参量难以区分“有效复杂性”与“无效噪动”。

## 2. 参考文献方法要点（PDF: `1-s2.0-S0378437125007290-main.pdf`）

该文提出“预测熵方差”用于盲识别临界区，核心流程如下：

1. 用单体轨迹序列训练自回归序列模型（文中为 RWKV-7）预测下一步方向分布；
2. 对每个时刻取预测分布 Shannon 熵 `H_t`；
3. 以时间方差 `Var(H_t)` 作为指标，扫描控制参时观察峰值；
4. 以全局序参量作对照，并与简单统计基线（角增量圆方差）比较。

该方法强调：临界附近并非“最不确定”本身，而是“预测不确定性随时间波动最强”。

## 3. 对追逃任务的直接启发

### 3.1 主要改进方向

将“是否临界”从全局序参量峰值，转为“局部行为可预测性结构”的时间波动特征：

- 不直接问“系统是否有序/无序”；
- 改问“个体行为可预测性是否处于高波动状态，并且这种状态是否与任务成功相关”。

### 3.2 推荐主指标（优先级）

1. **预测熵方差** `Var(H_pred)`（主指标）  
   - `H_pred(t)`：序列模型对下一步动作分布的熵；
   - episode 指标：`Var_t(H_pred)`；
   - group 指标：对 seed 求均值与 CI。

2. **预测熵突发性**（辅助）  
   - 例如 `P95(H_pred)-P50(H_pred)`、`kurtosis(H_pred)`；
   - 用于区分“持续高熵”与“临界式间歇波动”。

3. **模式切换率**（辅助）  
   - 将局部行为划分为若干模式（跟随、规避、探索、冲刺安全区）；
   - 统计单位时间切换次数与停留时长分布；
   - 临界附近通常表现为更强的多稳态切换。

4. **受迫响应恢复时间**（辅助）  
   - 注入小扰动（例如短时增大追捕速度或暂时屏蔽安全区感知）；
   - 记录关键量恢复时间；
   - 对应“任务内 critical slowing down”。

## 4. 与当前项目的最低可行落地方案（MVP）

## 4.1 数据输入

优先采用单 evader 轨迹（与论文一致的单体视角）：

- 每步输入：`Δθ_t`（或离散 heading token）；
- 可选加入局部观测 token（邻居数、最近追捕者距离分箱、是否检测到安全区）。

## 4.2 模型选择（工程可行优先）

先用轻量模型验证指标有效性，再决定是否上 RWKV：

1. baseline: GRU/LSTM（小模型）；
2. 若指标有效再切 RWKV/Transformer；
3. 训练目标：下一步方向分类（离散 bins）。

## 4.3 指标计算

对每条 episode：

1. 得到每步预测分布 `p_t`;
2. 计算 `H_t = -Σ p_t log p_t`;
3. 得到 `Var(H_t)`、`IQR(H_t)`、`kurtosis(H_t)`;
4. 与 `safe_frac`、`captured_frac` 做格点层相关分析。

## 4.4 对照与判据

必须同时报告三层结果：

1. 原始点层（run-level）；
2. 格点均值层（group-level）；
3. 分压力层（speed ratio stratified）。

判据建议：

- 若 `Var(H_pred)` 在参数轴出现稳定峰（bootstrapped peak CI 可复现）；
- 且该峰区对应更高 `safe_frac`（至少在中等压力层成立）；
- 则可支持“任务内近临界优势”。

## 5. 与单参数占比路线的结合方式

在已启用的 `align_control_mode="share"`、`angle_noise=0` 路线下，建议先做：

1. 固定 `sr=1.1` 与 `1.3` 两层；
2. 扫描 `w_align ∈ [0,1]`；
3. 用 `Var(H_pred)` 替代 `chi` 作为主临界代理；
4. 比较“`safe` 最优区”与“`Var(H_pred)` 峰区”是否重合。

若重合失败，再进入机制排查：

- 是否为强受迫有序主导；
- 是否 mode collapse（过强对齐导致可预测但低绩效）；
- 是否高噪无效探索主导（高熵但无策略性）。

## 6. 预期价值与风险

预期价值：

1. 仅用局部轨迹即可构造临界代理，减少对全局状态依赖；
2. 在对抗任务中更贴近“可预测性结构”而非仅物理序参量；
3. 可与现有 `chi/tau/xi` 并行，形成多视角证据链。

主要风险：

1. 指标可能对模型架构与超参数敏感；
2. 训练成本增加；
3. 若数据量不足，`Var(H_pred)` 可能受估计噪声影响。

对应缓解：

1. 先用轻量模型做敏感性扫描；
2. 用固定数据切分与 bootstrap CI；
3. 采用跨 `sr` 分层报告避免混合偏差。
