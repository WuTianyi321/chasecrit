# 2026-02-08

## 主题：基于 Var(H) 的 SOC 控制与预测追捕能力关系

### 1) 代码实现（SOC-v4-VarH）

- 新增 SOC 模式：`soc_mode="v4_varh"`，在 `evader_step` 中使用 `Var(H)`（`pred_entropy` 的方差）作为对齐占比反馈。
- 关键代码改动：
  - `src/chasecrit/config.py`
    - `SocMode` 扩展为 `"v1" | "v3" | "v4_varh"`
    - 新增参数：`soc_varh_target`、`soc_varh_gain`、`soc_varh_deadband`
  - `src/chasecrit/policies.py`
    - `evader_step` 支持 `v4_varh` 分支
    - `v4_varh` 控制律：按 `target - Var(H)` 反馈调整 `align_share`
  - `src/chasecrit/sim.py`
    - 新参数透传到 `evader_step`
  - `tests/test_soc_mode.py`
    - 新增 `test_soc_v4_varh_target_controls_align_share_direction`
- 验证：`uv run pytest -q` -> `19 passed`。

### 2) 首轮实验（未调参，效果较差）

- 配置目录：`configs/soc_varh_predability_20260208/`（`soc_varh_g*`）
- 运行目录：`runs/soc_varh_predability_20260208/`
- 设置：
  - 扫描 `intercept_gain={0,0.25,0.5,0.75,1.0}`
  - 固定 `speed_ratio=1.3`、`w_align=0.15`、`steps=600`
  - baseline + soc_varh，各 `120 seeds`
- 结果文档：`doc/results_20260208_soc_varh_predability/report.md`
- 结论：该组参数（`soc_varh_gain=3.0` 且含 stress/topple 通道）显著拉低 `safe`，判定为参数失配。

### 3) 调参与复跑（tuned）

- 调参策略：关闭 stress/topple 通道，仅保留 Var(H) 反馈，降低反馈增益。
- tuned 参数核心：
  - `soc_mode="v4_varh"`
  - `soc_varh_target=0.04`
  - `soc_varh_gain=0.5`
  - `soc_varh_deadband=0.001`
  - `soc_surprise_gain=0`、`soc_threat_gain=0`、`soc_align_drop=0`、`soc_topple_noise=0`
- tuned 配置：`configs/soc_varh_predability_20260208/soc_varh_tuned_g*.toml`
- tuned 运行：`runs/soc_varh_predability_20260208/soc_varh_tuned_g*/...`
- tuned 报告：`doc/results_20260208_soc_varh_tuned_predability/report.md`

### 4) tuned 关键结论（当前场景）

- `Var(H)` 随追捕预测能力 `intercept_gain` 略上升：`corr(Var(H), gain)=0.193`（SOC组 pooled）。
- `safe` 与 `Var(H)` 关系在当前参数下较弱且略负：`corr(safe, Var(H))=-0.063`（SOC组 pooled）。
- 与 baseline 配对差值：
  - `gain=0.25/0.5` 为显著负增益（CI 全负）；
  - `gain=0.75` 为正但 CI 跨 0；
  - `gain=0/1` 接近 0（CI 跨 0）。
- 解释：在该任务与参数下，Var(H)-feedback 可稳定控制 `Var(H)` 水平，但未稳定转化为生存率提升。

### 5) 下一步建议

1. 将 `speed_ratio` 由单点扩展到 `{1.1,1.3,1.5}`，看增益是否在高压层出现。
2. 采用双变量扫参（`soc_varh_target × soc_varh_gain`）并做贝叶斯/网格选优，再评估跨 gain 稳健性。
3. 引入“预测时域”能力维度（`intercept_tmax`）与 `intercept_gain` 形成二维能力图，再看 `Var(H)`-`safe` 映射是否更清晰。

### Documentation update: full algorithm specification

- Added method-spec document with full details of:
  - `SOC-v4-VarH` state variables, update equations, and parameter semantics;
  - predictive pursuer `p1_intercept` quadratic interception solver and gain/tmax blending;
  - fused step order and metric mapping.
- File: `doc/算法细节-SOC-v4-VarH与前瞻追捕.md`.
