# 2026-02-07 Daily Log

## SOC implementation and compatibility

- Added optional SOC controller fields to `EvaderConfig` in `src/chasecrit/config.py`.
- Added `EvaderSocState` and SOC branch in `src/chasecrit/policies.py`.
- Integrated SOC state lifecycle and SOC summary metrics in `src/chasecrit/sim.py`.
- Added SOC config templates:
  - `configs/soc_mvp.toml`
  - `configs/soc_mvp_soft.toml`

SOC is opt-in only (`soc_enabled=false` by default), preserving old behavior when disabled.

## Tests first, then implementation validation

- Added tests: `tests/test_soc_mode.py`
  - disabled SOC path is bitwise-identical for `evader_step`;
  - enabled SOC updates state and triggers toppling in low-threshold setup;
  - changing SOC parameters does not affect outputs when SOC is disabled.
- Validation:
  - `uv run pytest -q` -> `9 passed, 3 skipped`
  - `uv run pyright` -> `0 errors`

## Smoke experiments (SOC on/off comparison)

### Single-point comparison (`w_align=0.6`)

- baseline sweep:
  - `runs/sweep_20260207_103146_grid`
- SOC-MVP sweep:
  - `runs/sweep_20260207_103200_grid`
- setup:
  - `speed_ratio=1.1`, `steps=400`, `seeds=0..19`

Result snapshot:

- baseline: `safe_frac mean ≈ 0.2457`
- SOC-MVP: `safe_frac mean ≈ 0.2016`
- SOC-MVP shows persistent toppling:
  - `soc_topple_steps mean ≈ 387.5/400`
  - `soc_branch_ratio mean ≈ 1.107`

### Small grid comparison (`w_align in {0.4,0.6,0.8}`)

- baseline:
  - `runs/sweep_20260207_103331_grid`
  - report: `doc/results_20260207_soc_smoke_baseline/`
- SOC-MVP:
  - `runs/sweep_20260207_103347_grid`
  - report: `doc/results_20260207_soc_smoke_mvp/`
- SOC-Soft:
  - `runs/sweep_20260207_103434_grid`
  - report: `doc/results_20260207_soc_smoke_soft/`

Observed `safe_mean`:

- baseline: `0.2699 / 0.2457 / 0.2848` (`w=0.4/0.6/0.8`)
- SOC-MVP: `0.2395 / 0.2016 / 0.1383`
- SOC-Soft: `0.2465 / 0.1410 / 0.0992`

Interpretation:

- SOC mechanism signal exists (high toppling activity, branch ratio near 1+).
- Current SOC parameterizations do not yet improve pursuit-evasion performance.
- Likely regime is over-active (close to supercritical under this task pressure).

## Reader-facing report added

- `doc/实验结果-SOC算法接入与初步冒烟实验-20260207.md`

This report records implementation details, compatibility checks, smoke setup, quantitative results, and next-step scans.

## Clarification update

- Clarified in the SOC report that `w_align` under SOC-on is a set-point for per-agent dynamic alignment share `lambda_i(t)`, not a fixed per-step weight.
- Added explicit explanation section to avoid ambiguity between baseline fixed weight and SOC adaptive weight semantics.

## SOC-v2 design note

- Added a dedicated design document:
  - `doc/SOC-v2方案-基于预测熵波动的自组织临界控制.md`
- Core change in thought:
  - remove set-point regression to fixed `w_align` in SOC mode;
  - define dynamic alignment by stress mapping `lambda_i=f(s_i)` instead;
  - use predictive entropy fluctuation (`u_i`) as local driving term consistent with the cited paper’s `Var(H_pred)` idea.
- Document includes:
  - formal update equations,
  - SOC validity criteria before task-benefit claims,
  - staged experiment protocol for mechanism-first then performance.

## Pursuer strategy upgrade and re-run (alignment-share route)

- Implemented predictive pursuer policy `p1_intercept` and wired it into simulation policy switch.
  - code:
    - `src/chasecrit/policies.py` (`pursuer_step_p1_intercept`)
    - `src/chasecrit/sim.py` (policy dispatch by `cfg.pursuers.policy`)
- Added tests:
  - `tests/test_pursuer_policies.py`
  - checks:
    - interceptor leads lateral-moving target;
    - fallback to nearest chase when interception has no positive-time solution.
- Validation:
  - `uv run pytest -q` -> `11 passed, 3 skipped`
  - `uv run pyright` -> `0 errors`

### Re-run of previous alignment-share experiment with predictive pursuer

- Config:
  - `configs/walign_share_noise0_intercept.toml`
- Sweep:
  - `runs/sweep_20260207_110454_grid`
  - settings: `sr={0.9,1.1,1.3,1.4}`, `w_align=0..1 step 0.05`, `seeds=80`, `steps=600`
- Report:
  - `doc/results_20260207_walign_share_noise0_p1intercept_sr09111314_80seeds/`
- Reader-facing comparison summary:
  - `doc/实验结果-对齐比例-预测追捕复现实验-20260207.md`

Key outcomes versus previous `p0_nearest` share/noise0 baseline:

- Best `w_align` shifts lower (`~0.10~0.25`), and best `safe` increases across all `sr`.
- Negative `corr(safe,chi)` becomes stronger in every pressure layer.
- `w_align=1.0` remains poor, generally worse than `p0`.

## Additional expanded experiments and plots (more runs)

User requested more experiments and figures. Completed two larger follow-ups:

### A) Fine low-`w` policy comparison (large sample)

- `w_align in [0.00, 0.30], step=0.02`
- `speed_ratio in {0.9,1.1,1.3,1.4}`
- `seeds=120`, `steps=600`
- `p1_intercept`:
  - sweep `runs/sweep_20260207_150007_grid`
  - report `doc/results_20260207_walign_share_noise0_p1intercept_sr09111314_120seeds_fine03/`
- `p0_nearest`:
  - sweep `runs/sweep_20260207_151352_grid`
  - report `doc/results_20260207_walign_share_noise0_p0nearest_sr09111314_120seeds_fine03/`

### B) p1 boundary check by extending to `w=0.6`

- `w_align in [0.00, 0.60], step=0.02`
- same speed-ratio set, `seeds=60`, `steps=600`
- sweep `runs/sweep_20260207_152551_grid`
- report `doc/results_20260207_walign_share_noise0_p1intercept_sr09111314_60seeds_w06/`

### Cross-policy compare plots generated

- compare folder: `doc/results_20260207_walign_share_fine03_policy_compare/`
- key artifacts:
  - `policy_compare_summary.csv`
  - `figs/safe_vs_w_align_policy_compare.png`
  - `figs/delta_safe_vs_w_align_policy.png`
  - `figs/chi_vs_w_align_policy_compare.png`

### Key findings from expanded runs

- Under `p1_intercept`, best `safe` exceeds `p0` in `sr=1.1/1.3/1.4` for low-`w` scan.
- Boundary effect found in low-pressure `p1` (`sr=0.9` best at `w=0.30` in fine03); extension to `w<=0.6` moved optimum to `w=0.38`.
- Extended `p1` scan shows pressure split:
  - low pressure (`sr=0.9/1.1`) best near `w~0.38`;
  - higher pressure (`sr=1.3/1.4`) best near `w~0.10-0.12`.
- High alignment (`w>=0.5`) remains poor under predictive pursuer.

Reader-facing write-up:
- `doc/实验结果-对齐比例扩展实验与策略对照图-20260207.md`

## Criticality-benefit analysis after pursuer strategy change

To answer whether criticality remains beneficial after upgrading pursuer strategy, a matched full-grid high-repeat comparison was completed:

- `p1_intercept` full scan (`w_align=0..1 step 0.05`, seeds `120`):
  - sweep: `runs/sweep_20260207_155527_grid`
  - report: `doc/results_20260207_walign_share_noise0_p1intercept_sr09111314_120seeds_full/`
- `p0_nearest` full scan (same grid and seeds):
  - sweep: `runs/sweep_20260207_161229_grid`
  - report: `doc/results_20260207_walign_share_noise0_p0nearest_sr09111314_120seeds_full/`

Cross-policy analysis artifacts:

- `doc/results_20260207_criticality_under_policy_switch/criticality_policy_summary.csv`
- figures:
  - `safe_vs_walign_policy_switch.png`
  - `safe_vs_chi_policy_switch.png`
  - `corr_safe_chi_and_chilocal_policy_switch.png`
  - `near_critical_gain_chi_vs_chilocal_policy_switch.png`

Key finding:

- Using global `chi` as criticality proxy: `corr(safe,chi)` is negative in all pressure layers for both policies and becomes more negative under `p1_intercept`.
- Using local `chi_local` proxy: `corr(safe,chi_local)` is positive for all layers under `p1_intercept`, and quartile-based near-critical gain (`highQ-lowQ`) remains positive.

Reader-facing summary:
- `doc/实验结果-追捕策略改变后临界态与逃跑收益-20260207.md`
- Report presentation update:
  - embedded key figures directly inside the markdown report (not path-only listing), so the report is self-contained for review.
