# 2026-02-07 Daily Log

## SOC implementation and compatibility

- Added optional SOC controller fields to `EvaderConfig` in `src/chasecrit/config.py`.
- Added `EvaderSocState` and SOC branch in `src/chasecrit/policies.py`.
- Integrated SOC state lifecycle and SOC summary metrics in `src/chasecrit/sim.py`.
- Added SOC config templates:
  - `configs/soc_mvp.toml`
  - `configs/soc_mvp_soft.toml`

SOC is opt-in only (`soc_enabled=false` by default), preserving old behavior when disabled.

## Tests first, then implementation validation

- Added tests: `tests/test_soc_mode.py`
  - disabled SOC path is bitwise-identical for `evader_step`;
  - enabled SOC updates state and triggers toppling in low-threshold setup;
  - changing SOC parameters does not affect outputs when SOC is disabled.
- Validation:
  - `uv run pytest -q` -> `9 passed, 3 skipped`
  - `uv run pyright` -> `0 errors`

## Smoke experiments (SOC on/off comparison)

### Single-point comparison (`w_align=0.6`)

- baseline sweep:
  - `runs/sweep_20260207_103146_grid`
- SOC-MVP sweep:
  - `runs/sweep_20260207_103200_grid`
- setup:
  - `speed_ratio=1.1`, `steps=400`, `seeds=0..19`

Result snapshot:

- baseline: `safe_frac mean ≈ 0.2457`
- SOC-MVP: `safe_frac mean ≈ 0.2016`
- SOC-MVP shows persistent toppling:
  - `soc_topple_steps mean ≈ 387.5/400`
  - `soc_branch_ratio mean ≈ 1.107`

### Small grid comparison (`w_align in {0.4,0.6,0.8}`)

- baseline:
  - `runs/sweep_20260207_103331_grid`
  - report: `doc/results_20260207_soc_smoke_baseline/`
- SOC-MVP:
  - `runs/sweep_20260207_103347_grid`
  - report: `doc/results_20260207_soc_smoke_mvp/`
- SOC-Soft:
  - `runs/sweep_20260207_103434_grid`
  - report: `doc/results_20260207_soc_smoke_soft/`

Observed `safe_mean`:

- baseline: `0.2699 / 0.2457 / 0.2848` (`w=0.4/0.6/0.8`)
- SOC-MVP: `0.2395 / 0.2016 / 0.1383`
- SOC-Soft: `0.2465 / 0.1410 / 0.0992`

Interpretation:

- SOC mechanism signal exists (high toppling activity, branch ratio near 1+).
- Current SOC parameterizations do not yet improve pursuit-evasion performance.
- Likely regime is over-active (close to supercritical under this task pressure).

## Reader-facing report added

- `doc/实验结果-SOC算法接入与初步冒烟实验-20260207.md`

This report records implementation details, compatibility checks, smoke setup, quantitative results, and next-step scans.

## Clarification update

- Clarified in the SOC report that `w_align` under SOC-on is a set-point for per-agent dynamic alignment share `lambda_i(t)`, not a fixed per-step weight.
- Added explicit explanation section to avoid ambiguity between baseline fixed weight and SOC adaptive weight semantics.

## SOC-v2 design note

- Added a dedicated design document:
  - `doc/SOC-v2方案-基于预测熵波动的自组织临界控制.md`
- Core change in thought:
  - remove set-point regression to fixed `w_align` in SOC mode;
  - define dynamic alignment by stress mapping `lambda_i=f(s_i)` instead;
  - use predictive entropy fluctuation (`u_i`) as local driving term consistent with the cited paper’s `Var(H_pred)` idea.
- Document includes:
  - formal update equations,
  - SOC validity criteria before task-benefit claims,
  - staged experiment protocol for mechanism-first then performance.

## Pursuer strategy upgrade and re-run (alignment-share route)

- Implemented predictive pursuer policy `p1_intercept` and wired it into simulation policy switch.
  - code:
    - `src/chasecrit/policies.py` (`pursuer_step_p1_intercept`)
    - `src/chasecrit/sim.py` (policy dispatch by `cfg.pursuers.policy`)
- Added tests:
  - `tests/test_pursuer_policies.py`
  - checks:
    - interceptor leads lateral-moving target;
    - fallback to nearest chase when interception has no positive-time solution.
- Validation:
  - `uv run pytest -q` -> `11 passed, 3 skipped`
  - `uv run pyright` -> `0 errors`

### Re-run of previous alignment-share experiment with predictive pursuer

- Config:
  - `configs/walign_share_noise0_intercept.toml`
- Sweep:
  - `runs/sweep_20260207_110454_grid`
  - settings: `sr={0.9,1.1,1.3,1.4}`, `w_align=0..1 step 0.05`, `seeds=80`, `steps=600`
- Report:
  - `doc/results_20260207_walign_share_noise0_p1intercept_sr09111314_80seeds/`
- Reader-facing comparison summary:
  - `doc/实验结果-对齐比例-预测追捕复现实验-20260207.md`

Key outcomes versus previous `p0_nearest` share/noise0 baseline:

- Best `w_align` shifts lower (`~0.10~0.25`), and best `safe` increases across all `sr`.
- Negative `corr(safe,chi)` becomes stronger in every pressure layer.
- `w_align=1.0` remains poor, generally worse than `p0`.

## Additional expanded experiments and plots (more runs)

User requested more experiments and figures. Completed two larger follow-ups:

### A) Fine low-`w` policy comparison (large sample)

- `w_align in [0.00, 0.30], step=0.02`
- `speed_ratio in {0.9,1.1,1.3,1.4}`
- `seeds=120`, `steps=600`
- `p1_intercept`:
  - sweep `runs/sweep_20260207_150007_grid`
  - report `doc/results_20260207_walign_share_noise0_p1intercept_sr09111314_120seeds_fine03/`
- `p0_nearest`:
  - sweep `runs/sweep_20260207_151352_grid`
  - report `doc/results_20260207_walign_share_noise0_p0nearest_sr09111314_120seeds_fine03/`

### B) p1 boundary check by extending to `w=0.6`

- `w_align in [0.00, 0.60], step=0.02`
- same speed-ratio set, `seeds=60`, `steps=600`
- sweep `runs/sweep_20260207_152551_grid`
- report `doc/results_20260207_walign_share_noise0_p1intercept_sr09111314_60seeds_w06/`

### Cross-policy compare plots generated

- compare folder: `doc/results_20260207_walign_share_fine03_policy_compare/`
- key artifacts:
  - `policy_compare_summary.csv`
  - `figs/safe_vs_w_align_policy_compare.png`
  - `figs/delta_safe_vs_w_align_policy.png`
  - `figs/chi_vs_w_align_policy_compare.png`

### Key findings from expanded runs

- Under `p1_intercept`, best `safe` exceeds `p0` in `sr=1.1/1.3/1.4` for low-`w` scan.
- Boundary effect found in low-pressure `p1` (`sr=0.9` best at `w=0.30` in fine03); extension to `w<=0.6` moved optimum to `w=0.38`.
- Extended `p1` scan shows pressure split:
  - low pressure (`sr=0.9/1.1`) best near `w~0.38`;
  - higher pressure (`sr=1.3/1.4`) best near `w~0.10-0.12`.
- High alignment (`w>=0.5`) remains poor under predictive pursuer.

Reader-facing write-up:
- `doc/实验结果-对齐比例扩展实验与策略对照图-20260207.md`

## Criticality-benefit analysis after pursuer strategy change

To answer whether criticality remains beneficial after upgrading pursuer strategy, a matched full-grid high-repeat comparison was completed:

- `p1_intercept` full scan (`w_align=0..1 step 0.05`, seeds `120`):
  - sweep: `runs/sweep_20260207_155527_grid`
  - report: `doc/results_20260207_walign_share_noise0_p1intercept_sr09111314_120seeds_full/`
- `p0_nearest` full scan (same grid and seeds):
  - sweep: `runs/sweep_20260207_161229_grid`
  - report: `doc/results_20260207_walign_share_noise0_p0nearest_sr09111314_120seeds_full/`

Cross-policy analysis artifacts:

- `doc/results_20260207_criticality_under_policy_switch/criticality_policy_summary.csv`
- figures:
  - `safe_vs_walign_policy_switch.png`
  - `safe_vs_chi_policy_switch.png`
  - `corr_safe_chi_and_chilocal_policy_switch.png`
  - `near_critical_gain_chi_vs_chilocal_policy_switch.png`

Key finding:

- Using global `chi` as criticality proxy: `corr(safe,chi)` is negative in all pressure layers for both policies and becomes more negative under `p1_intercept`.
- Using local `chi_local` proxy: `corr(safe,chi_local)` is positive for all layers under `p1_intercept`, and quartile-based near-critical gain (`highQ-lowQ`) remains positive.

Reader-facing summary:
- `doc/实验结果-追捕策略改变后临界态与逃跑收益-20260207.md`
- Report presentation update:
  - embedded key figures directly inside the markdown report (not path-only listing), so the report is self-contained for review.
  - added explicit `safe` vs `chi_local` scatter figure and embedded it in the report:
    - `doc/results_20260207_criticality_under_policy_switch/figs/safe_vs_chi_local_policy_switch.png`

## 2026-02-07 17:08 Git ignore update (LaTeX artifacts)
- Added LaTeX ignore rules in .gitignore including paper/*.synctex.gz and paper/main.pdf.
- Removed paper/main.pdf from Git tracking via git rm --cached, keeping local build file untracked.


## 2026-02-07 17:30-17:45 追捕策略预测依赖与近临界判定补充实验

### 本轮目标与计划

- 目标：回答“在改变追捕者策略后，何种临界性判定下近临界有益”。
- 计划：
  1) 复用既有 120-seed 全域结果做 `chi/chi_local` 判定；
  2) 新跑 `--save-runs` 批次补可预测性指标 `Var(H_pred)`；
  3) 合并形成策略切换结论并写读者报告。

### 新跑批次（可预测性专用）

- `p0_nearest` save-runs 扫描：
  - command: `uv run chasecrit sweep-grid --config configs/walign_share_noise0.toml --w-align 0 0.1 ... 1.0 --speed-ratio 1.1 1.3 --seeds 0..39 --steps 600 --save-runs --jobs 1`
  - output: `runs/sweep_20260207_172412_grid` (`880` runs)
- `p1_intercept` save-runs 扫描：
  - command: `uv run chasecrit sweep-grid --config configs/walign_share_noise0_intercept.toml --w-align 0 0.1 ... 1.0 --speed-ratio 1.1 1.3 --seeds 0..39 --steps 600 --save-runs --jobs 1`
  - output: `runs/sweep_20260207_173014_grid` (`880` runs)

### 报告与聚合产物

- 任务指标报告：
  - `doc/results_20260207_walign_share_noise0_p0nearest_sr1113_40seeds_save_runs/`
  - `doc/results_20260207_walign_share_noise0_p1intercept_sr1113_40seeds_save_runs/`
- 预测熵报告：
  - `doc/results_20260207_pred_entropy_p0nearest_sr1113_40seeds/`
  - `doc/results_20260207_pred_entropy_p1intercept_sr1113_40seeds/`
- 综合澄清目录：
  - `doc/results_20260207_policy_switch_criticality_clarified/`
  - 核心文件：
    - `criticality_summary_policy_switch_120seed.csv`
    - `predictability_summary_policy_switch_40seed.csv`
    - `delta_policy_vs_walign_120seed.csv`

### 新的读者向结论（任务内判定）

- 全局 `chi`：在 `p0/p1` 下均与 `safe` 负相关，不能作为“更近临界更有益”的有效判据。
- 局部 `chi_local`：在 `p1_intercept` 下对 `safe` 保持正相关（`sr=1.1/1.3/1.4`），支持“局部近临界样波动有益”。
- 可预测性 `Var(H_pred)`：在 `p1_intercept` 下 `highQ-lowQ safe` 明显高于 `p0`（如 `sr=1.1`: `0.095` vs `0.031`），支持“追捕者越依赖预测，局部不可预测性越有利于逃逸”。

### 报告文件

- `doc/实验结果-追捕策略预测依赖与近临界收益判定-20260207.md`

### 过程中的实现观察

- `sweep-grid` 在 `jobs>1` 分支即使 `--save-runs` 也不会写有效 `run_dir`（worker 走 `run_summary`），因此 `report-pred-entropy` 需要使用 `jobs=1` 生成可用时序批次。

## 2026-02-07 20:30+ SOC further research (mechanism + performance)

### Goal

- Extend SOC study beyond smoke tests, using two-stage protocol:
  1) broad parameter screening for `safe` + SOC mechanism proxies;
  2) deep save-runs analysis for avalanche/activity-spectrum evidence.

### Stage A: broad SOC scan

- variant configs generated under `configs/soc_scan_20260207/`.
- sweep root: `runs/soc_scan_20260207/` with manifest `manifest.csv`.
- settings:
  - policy: `p1_intercept`
  - `align_control_mode="share"`, `angle_noise=0`, `w_align=0.15`
  - `speed_ratio={1.1,1.3}`
  - `steps=600`, `seeds=0..29`
  - `jobs=8`, no per-run timeseries/events.
- total variants: 17 (including baseline).

Key broad findings:

- Most SOC variants under current controller underperform baseline in `safe_mean`.
- `soc_branch_ratio_mean` is mostly >1 (`~1.06..1.15`), indicating over-active regime tendency.
- Best average variant: `soc_th024_cp010_rx003` with tiny mean gain (`+0.0038`) but still branch ratio around `1.11`.

Artifacts:

- `doc/results_20260207_soc_further_research/soc_scan_runs.csv`
- `doc/results_20260207_soc_further_research/soc_scan_summary_by_variant_sr.csv`
- `doc/results_20260207_soc_further_research/soc_scan_summary_with_baseline_delta.csv`
- `doc/results_20260207_soc_further_research/soc_scan_candidate_ranking.csv`
- figs:
  - `safe_vs_branch_ratio_soc_scan.png`
  - `delta_safe_by_variant_soc_scan.png`

### Stage B: deep save-runs for representative variants

Deep set (`seeds=0..19`, `steps=600`, `jobs=1`, `--save-runs`):

- `baseline`
- `soc_best_gain` (`soc_th024_cp010_rx003`)
- `soc_branch_near1` (`soc_th036_cp022_rx000`)
- `soc_low_activity` (`soc_th070_cp000_rx000_soft`)

deep sweep manifest:

- `runs/soc_scan_20260207_deep/manifest_deep.csv`

Mechanism extraction from per-run `timeseries.csv` (`soc_topples`):

- avalanche size/duration from contiguous positive-activity segments;
- activity spectrum slope `beta` from log-log periodogram fit.

Deep findings:

- `soc_best_gain` shows tiny positive `safe` delta at both pressure layers (`~+0.0016/+0.0020`), but paired 95% CI crosses zero.
- `soc_branch_near1` underperforms at `sr=1.3`.
- `soc_low_activity` produces many micro-avalanches (high count, small size), while other SOC variants produce fewer but much larger avalanches.
- `beta` differs across SOC regimes:
  - `soc_best_gain`: about `1.20~1.30`
  - `soc_branch_near1`: about `1.38~1.41`
  - `soc_low_activity`: about `0.67~1.00`

Deep artifacts:

- `doc/results_20260207_soc_further_research/soc_deep_per_run_metrics.csv`
- `doc/results_20260207_soc_further_research/soc_deep_group_summary.csv`
- `doc/results_20260207_soc_further_research/soc_deep_group_summary_with_delta.csv`
- `doc/results_20260207_soc_further_research/soc_deep_avalanche_summary.csv`
- `doc/results_20260207_soc_further_research/soc_deep_delta_safe_paired_ci.csv`
- figs:
  - `soc_deep_safe_compare.png`
  - `soc_deep_avalanche_ccdf_sr11.png`
  - `soc_deep_avalanche_ccdf_sr13.png`
  - `soc_deep_activity_beta_compare.png`

### Predictive-entropy cross-check for deep set

Generated `report-pred-entropy` for all 4 deep sweeps:

- `doc/results_20260207_soc_further_research/pred_entropy_baseline/`
- `doc/results_20260207_soc_further_research/pred_entropy_soc_best_gain/`
- `doc/results_20260207_soc_further_research/pred_entropy_soc_branch_near1/`
- `doc/results_20260207_soc_further_research/pred_entropy_soc_low_activity/`

Merged table:

- `doc/results_20260207_soc_further_research/soc_deep_pred_entropy_summary.csv`

Observation:

- SOC variants modify `Var(H_pred)` structure, but improvement in unpredictability does not translate to robust significant `safe` gains under current controller.

### Reader-facing report

- `doc/实验结果-SOC进一步研究与机制判据-20260207.md`

Overall status update:

- SOC mechanism signals are now better characterized, but current SOC controller still lacks robust performance advantage over fixed-parameter baseline.
- Next step should prioritize SOC-v2 implementation (no fixed-point relax to `w_align`, stress-mapped `lambda_i`, and local predictive-entropy drive).

## 2026-02-07 21:00+ SOC-v3 paper-aligned attempt

### Why

User指出此前 SOC 方案未体现论文 `1-s2.0-S0378437125007290-main.pdf` 的核心思路（单体轨迹 + 预测熵方差 blind identification）。本轮改为“论文主线优先”的实现与验证。

### Code changes

- `src/chasecrit/config.py`
  - added SOC-v3 related knobs:
    - `soc_mode` (`v1`/`v3`), `soc_relax_to_w_align`, `soc_stress_to_align_gain`
    - `soc_entropy_gain`, `soc_entropy_ema_alpha`
    - `soc_heading_bins`, `soc_heading_smoothing`, `soc_heading_decay`
- `src/chasecrit/policies.py`
  - `EvaderSocState` extended with online sequence-state buffers for local predictive-entropy estimation.
  - added SOC-v3 branch:
    - no mandatory relax to fixed `w_align`;
    - `lambda_i=f(stress_i)` mapping;
    - stress drive includes entropy fluctuation term `|H_i-EMA(H_i)|`.
- `src/chasecrit/sim.py`
  - record additional SOC metrics in summary/timeseries:
    - `soc_pred_entropy_mean`
    - `soc_pred_entropy_var`
    - `soc_entropy_fluct_mean`
- tests:
  - `tests/test_soc_mode.py` added SOC-v3 behavior checks.

Validation:

- `uv run pytest -q` => `16 passed`
- `uv run pyright` => `0 errors`

### New experiment configs

- `configs/soc_v3_20260207/baseline_p1_share_noise0_w015.toml`
- `configs/soc_v3_20260207/soc_v3_no_entropy.toml`
- `configs/soc_v3_20260207/soc_v3_entropy_mid.toml`
- `configs/soc_v3_20260207/soc_v3_entropy_high.toml`

### Broad scan (SOC-v3)

- sweep root: `runs/soc_v3_scan_20260207/`
- manifest: `runs/soc_v3_scan_20260207/manifest.csv`
- setup:
  - policy `p1_intercept`, `w_align=0.15`, `angle_noise=0`
  - `speed_ratio={1.1,1.3}`, `seeds=30`, `steps=600`
- summary outputs:
  - `doc/results_20260207_soc_v3_paper_aligned/soc_v3_summary.csv`
  - figs: `safe_compare_soc_v3.png`, `safe_vs_pred_entropy_var_soc_v3.png`

Broad result snapshot:

- baseline remains best on mean safe for both `sr=1.1` and `sr=1.3`.
- `soc_v3_no_entropy` collapses performance.
- entropy-driven v3 raises `Var(H_pred)` proxies but does not yield robust task gains.

### Deep paper-style comparison

- deep sweep root: `runs/soc_v3_scan_20260207_deep/`
- manifest: `runs/soc_v3_scan_20260207_deep/manifest.csv`
- variants: baseline + `soc_v3_entropy_mid` + `soc_v3_entropy_high`
- setup: `seeds=20`, `speed_ratio={1.1,1.3}`, `steps=600`, `--save-runs`, `jobs=1`

Generated predictive-entropy reports:

- `doc/results_20260207_soc_v3_paper_aligned/pred_entropy_baseline/`
- `doc/results_20260207_soc_v3_paper_aligned/pred_entropy_soc_v3_entropy_mid/`
- `doc/results_20260207_soc_v3_paper_aligned/pred_entropy_soc_v3_entropy_high/`

Added benchmark (paper-style comparison):

- computed circular variance of single-agent angle increments from `timeseries.csv`.
- merged output:
  - `doc/results_20260207_soc_v3_paper_aligned/soc_v3_deep_per_run_with_benchmark.csv`
  - `doc/results_20260207_soc_v3_paper_aligned/soc_v3_deep_summary_with_benchmark.csv`
  - `doc/results_20260207_soc_v3_paper_aligned/soc_v3_deep_paired_ci.csv`
  - fig: `soc_v3_deep_benchmark_scatter.png`

Deep result snapshot:

- `sr=1.1`: `soc_v3_entropy_mid` shows weak positive `delta_safe` (~+0.013) but CI crosses 0.
- `sr=1.3`: SOC-v3 entropy variants underperform baseline; `entropy_high` CI is fully negative.
- both entropy variants strongly increase `Var(H_pred)` vs baseline; circular-variance shift is small.

### Reader-facing report

- `doc/实验结果-SOCv3论文思路对齐尝试-20260207.md`

Current interpretation:

- methodologically closer to cited paper is achieved (Var(H) priority + benchmark comparison),
- but SOC-v3 still lacks robust cross-pressure task benefit under current settings.
