# ChaseCrit - Agent Instructions

## 项目总体理解

本项目研究的问题是：**逃跑者集群处于近临界态/临界态时，是否能在追逃任务中带来性能优势**。研究对象主要聚焦在**逃跑者集群**（evaders / swarm），追捕者（pursuers）可以从简单策略开始逐步增强。

项目拟采用“两条腿走路”的路线：

1. **参数扫描路线（Near-critical tuning）**
   - 选取一种集群逃跑/集群运动算法，其中包含一个可调参数 `w` 表征“跟随邻居行为”的程度（从完全跟随到完全不跟随）。
   - 在无追捕/有追捕场景中分别扫描 `w`，用统计指标找出表现出临界特征的参数区域，并检验该区域是否与追逃效果最优区域重合。

2. **自组织临界路线（SOC / self-tuning）**
   - 设计一种让个体基于局部观测自动调参的逃跑策略，使集群在外部驱动与耗散下形成自组织（准）临界状态，并在追逃任务中验证收益。

## 场景与任务要求（研究驱动）

当前已对齐的默认设定（后续如需更改可在实验配置中体现）：

- **场景**：2D 连续空间
- **信息约束**：逃跑者不能显式通讯，只能通过局部观测看到邻居动作/位置
- **追捕者能力**：允许预测拦截与协作；实现上从简单策略开始逐步增强

当前优先落地的基准任务场景（用于近期实现与实验）：

- **多安全区 + 容量限制 + 缓慢移动**：逃跑者只有接近到一定程度才知道安全区位置；
- **容量未知**：逃跑者只能知道“该安全区当前是否有效”，不知道剩余容量；
- **失效即消失**：安全区容量耗尽后立刻失效，并在逻辑上消失（不可再被检测/不可进入）；
- **随机刷新**：安全区失效后以随机机制刷新；有边界时从边界刷新；并设置最大有效安全区数量上限以限制同时存在的安全区；
- **可调难度**：追捕强度、边界条件、障碍均做成可调参数，用于稳健性实验。

为尽量凸显“临界态可能的优势”，追逃场景应具备：

- **信息局部性与不确定性**：个体只能局部感知追捕者/同伴/安全区线索；安全区位置可固定/移动/部分未知；可能存在“进入某区域后才发现安全区”的机制。
- **探索-利用权衡**：例如多个候选安全区、容量限制、必须分裂-重组、路径受阻或有动态威胁，使得单纯高凝聚或完全分散都不占优。
- **可量化目标**：限定时间窗；成功定义清晰（到达安全区、存活数、到达时间、被捕率等）；可重复随机种子与参数化配置。

## 评价与分析要求（建议默认）

- **追逃性能指标**：成功率/存活率、到达时间分布、被捕时间分布、进入安全区人数（含容量约束下的分配效率）、集群破碎/重组次数等。
- **临界性指标（与算法无关的观测层）**：序参量（如极化度/相干速度）、涨落与“易感性”（方差峰值）、相关长度/相关时间、事件/扰动“雪崩”规模分布（近幂律）、1/f 型谱等。
- **实验规范**：每个配置至少多随机种子重复；记录参数、随机种子、指标原始时间序列；报告均值与置信区间/分位数。

## 工程与协作要求（对后续实现的约定）

- **优先保持可复现**：所有实验配置应可通过配置文件/命令行一次性重跑；日志中包含版本、参数、随机种子。
- **最小可用闭环**：先实现简单 2D 场景 + 基线策略 + 指标计算 + 批量扫描，再迭代复杂场景与 SOC。
- **实现原则**：避免把“评价指标计算”混在“策略逻辑”里；环境动力学、策略、指标、可视化尽量解耦。
- **语言与运行**：项目以 Python 为主（见 `pyproject.toml`、`.python-version`），默认目标版本为 3.14。

## 文档与协作规范

- **文档面向读者**：`doc/` 下的 Markdown 以论文/技术文档读者为对象，使用陈述式写法；避免对话式措辞（例如“你/我/请你/你希望”等）与问答式段落。
- **讨论留在对话**：需求澄清、决策讨论与待选项应在对话中完成；文档只保留已定方案、可选配置与可复现实验规范。
- **规格优先**：场景规则、可观测信息、动力学约束、事件定义与指标计算必须在文档中明确到可实现/可复现的程度，并给出默认参数与可调参数列表。
- **变更同步**：当场景机制或实验矩阵发生变化时，应同步更新对应文档与本 `AGENTS.md` 中的“当前优先落地场景”摘要，避免实现与文档偏离。

## 实验结果写入规范

- **结果必须写入 `doc/`**：形成可复现的阶段性结论时，将实验设置、扫描范围、样本量（seed 数/episode 数）、指标定义与图表写入 `doc/`。
- **结果文档内容要求**：
  - 标注实验 ID（日期/时间戳），并给出产物路径（原始 sweep 目录、汇总 CSV、图像目录）。
  - 明确固定项与变量项（例如固定 `N_p`，扫描 `v_p/v_e` 与 `w_align`），并给出默认配置来源（`configs/*.toml` 或 sweep 的 `base_config.json`）。
  - 图表以相对路径引用，并在正文中解释“图显示了什么”和“初步结论是什么”。
  - 初步结论需包含下一步动作（扩展参数、稳健性检验、对照组/消融）。
- **长扫进度落盘**：长时间 sweep 必须输出可追踪进度（例如 `progress.jsonl` 与 `progress.txt`，包含 completed/total/ETA），便于估算剩余时间与故障恢复。

## Git 协作规范

- 默认在 `main`（或仓库约定的主分支）上保持可运行状态；较大的改动优先使用短生命周期分支并通过 PR 合并。
- 提交应拆分为逻辑清晰的 commits（例如：功能实现 / 实验与报告 / 文档与规范），提交信息使用简洁的祈使句风格。
- 不提交大体积/不可复现的运行产物：`runs/`、`.venv/`、`.claude/` 等应保持在 `.gitignore` 中；`doc/` 下仅提交聚合结果与图表。
- 推送前运行最小自检：`uv sync`、`uv run python -m compileall -q src`，以及至少一次 `uv run chasecrit run ...` 冒烟测试。

## 记忆管理（`memory/`）

- `memory/MEMORY.md`：长期记忆（稳定事实、关键决策、约定、已知限制）。仅记录“跨天仍然重要”的内容，保持结构化与可检索。
- `memory/YYYY-MM-DD.md`：每日原始记录（当天发生的事情、运行的关键命令、得到的中间结论、待办与风险）。按日期新增，不做过度整理。
- 使用方式：
  - 每次完成一个阶段性工作（例如一次 sweep + 报告产出）后，将“可复现结论与路径”写入当天的 `memory/YYYY-MM-DD.md`。
  - 当某个信息被证明会反复用到（例如场景机制、输出约定、实验命令模板、已知坑），再提炼进入 `memory/MEMORY.md`。
  - `MEMORY.md` 只做增量维护，避免堆叠冗余；过时内容需标注“已过时”或替换为当前版本。
